<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISRO Mission Analysis Dashboard</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js for charting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js Date Adapter (for time scales) -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e2e8f0; /* Lighter background for more contrast */
        }
        .sidebar {
            background-color: #2d3748; /* Darker blue-gray for sidebar */
            color: #f9fafb; /* Light text */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .nav-item {
            transition: all 0.2s ease-in-out;
            border-radius: 0.5rem; /* Rounded corners for nav items */
        }
        .nav-item:hover {
            background-color: #4a5568; /* Darker hover */
            transform: translateX(5px); /* Slight slide effect on hover */
        }
        .nav-item.bg-blue-700 {
            background-color: #2b6cb0; /* Stronger blue for active state */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .section-container {
            min-height: calc(100vh - 4rem); /* Adjust for header if any */
            padding: 2rem;
            background-color: #ffffff; /* White background for content areas */
            border-radius: 0.75rem; /* More rounded corners for sections */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .card {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        canvas {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem; /* Rounded corners for charts */
        }
        h1, h2, h3 {
            color: #2d3748; /* Dark text for headings */
        }
    </style>
</head>
<body class="flex">
    <!-- Sidebar -->
    <div class="sidebar w-64 min-h-screen p-6 rounded-r-lg">
        <h1 class="text-3xl font-bold mb-8 text-blue-300">ISRO Dashboard</h1>
        <nav>
            <ul>
                <li><a href="#" class="nav-item block py-2 px-4 mb-2 text-lg font-medium" onclick="showPage('home')">Home</a></li>
                <li><a href="#" class="nav-item block py-2 px-4 mb-2 text-lg font-medium" onclick="showPage('historical')">Historical Analysis</a></li>
                <li><a href="#" class="nav-item block py-2 px-4 mb-2 text-lg font-medium" onclick="showPage('comparative')">Comparative Analysis</a></li>
                <li><a href="#" class="nav-item block py-2 px-4 mb-2 text-lg font-medium" onclick="showPage('predictor')">Mission Predictor</a></li>
                <li><a href="#" class="nav-item block py-2 px-4 mb-2 text-lg font-medium" onclick="showPage('clusters')">Mission Clusters</a></li>
            </ul>
        </nav>
    </div>

    <!-- Main Content Area -->
    <div class="flex-1 p-8">
        <!-- Home Page -->
        <div id="home-page" class="section-container">
            <h1 class="text-4xl font-bold mb-6">ISRO Mission Analysis Dashboard</h1>
            <p class="text-lg text-gray-700 mb-8">A comprehensive, data-driven platform to explore ISRO's mission history.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <div class="card">
                    <img src="images/images (3).jpg" onerror="this.onerror=null;this.src='https://placehold.co/600x400/000000/FFFFFF?text=PSLV+Launch+Image';" alt="PSLV Launch" class="w-full h-auto rounded-md mb-4">
                    <p class="text-center text-gray-700 text-sm">PSLV Launch</p>
                </div>
                <div class="card">
                    <!-- Using the provided GSLV image -->
                    <img src="images/On-August-23--Isro-created-history-by-successfully_1695234675844_1703185578114.jpg" onerror="this.onerror=null;this.src='https://placehold.co/600x400/000000/FFFFFF?text=GSLV+Launch+Image';" alt="GSLV Launch" class="w-full h-auto rounded-md mb-4">
                    <p class="text-center text-gray-700 text-sm">GSLV Launch</p>
                </div>
            </div>

            <hr class="my-10 border-gray-300">

            <h2 class="text-3xl font-bold mb-4">Project Overview: Unveiling ISRO's Legacy</h2>
            <p class="text-gray-700 text-lg leading-relaxed mb-6">
                Welcome to the ISRO Mission Analysis Dashboard, your interactive gateway to understanding the rich history and remarkable achievements of the Indian Space Research Organisation. This platform transforms raw mission data into insightful visualizations, offering a unique perspective on India's journey in space exploration.
            </p>
            <p class="text-gray-700 text-lg leading-relaxed mb-6">
                Our mission is to make complex aerospace data accessible and engaging for enthusiasts, students, and researchers alike. By consolidating key metrics and presenting them through intuitive charts, we aim to highlight significant trends and patterns across ISRO's diverse portfolio of space missions.
            </p>
            <h3 class="text-2xl font-bold mb-3">Key Features of this Dashboard:</h3>
            <ul class="list-disc list-inside text-gray-700 text-lg leading-relaxed mb-6 space-y-2">
                <li>
                    Historical Analysis: Dive deep into past missions. This section allows you to explore trends over time, such as how payload mass has evolved, and examine success rates across different months, providing context to ISRO's operational patterns. You can filter data by launch vehicle and payload type to customize your view.
                </li>
                <li>
                    Comparative Analysis: Pitting ISRO's workhorse, the PSLV (Polar Satellite Launch Vehicle), against its heavier-lift counterpart, the GSLV (Geosynchronous Satellite Launch Vehicle). This interactive tool enables a side-by-side comparison of their performance metrics, including total missions, success rates, average payload mass, and mission costs, helping you understand their respective strengths.
                </li>
                <li>
                    Mission Predictor: Explore the historical probability of mission success based on key parameters like launch vehicle, payload mass, and mission cost. By adjusting these inputs, you can see how different configurations have historically fared, offering insights into potential outcomes for future missions.
                </li>
                <li>
                    Mission Clusters: Uncover hidden groupings within ISRO's missions. By applying advanced clustering techniques based on critical parameters like payload mass and mission cost, this section identifies natural categories of missions, revealing potential strategies or evolution in ISRO's satellite deployment.
                </li>
            </ul>
            <p class="text-gray-700 text-lg mt-4">
                This analysis is powered by a comprehensive dataset of <span id="missionCount" class="font-bold"></span> ISRO missions, offering a robust foundation for your explorations.
            </p>
        </div>

        <!-- Historical Analysis Page -->
        <div id="historical-page" class="section-container hidden">
            <h1 class="text-4xl font-bold mb-6">Historical Mission Analysis</h1>
            <p class="text-lg text-gray-700 mb-8">Explore Mission Data Trends and Visualizations</p>

            <div class="card mb-8">
                <h2 class="text-2xl font-bold mb-4">Filters</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="vehicleFilter" class="block text-sm font-medium text-gray-700 mb-2">Launch Vehicle</label>
                        <select id="vehicleFilter" multiple class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                    <div>
                        <label for="payloadFilter" class="block text-sm font-medium text-gray-700 mb-2">Payload Type</label>
                        <select id="payloadFilter" multiple class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                </div>
            </div>

            <h2 class="text-3xl font-bold mb-4">Payload Mass vs. Launch Year</h2>
            <div class="card mb-8">
                <canvas id="payloadMassChart"></canvas>
            </div>

            <hr class="my-10 border-gray-300">

            <h2 class="text-3xl font-bold mb-4">Mission Success Rate by Month</h2>
            <div class="card mb-8">
                <canvas id="successRateChart"></canvas>
            </div>
        </div>

        <!-- Comparative Analysis Page -->
        <div id="comparative-page" class="section-container hidden">
            <h1 class="text-4xl font-bold mb-6">Launch Vehicle Comparative Analysis</h1>
            <p class="text-lg text-gray-700 mb-8">Compare the performance of two different launch vehicles side-by-side.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4">Select Vehicle 1</h2>
                    <select id="compareVehicle1" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 mb-4">
                        <!-- Options will be populated by JS -->
                    </select>
                    <div class="space-y-2 text-gray-700">
                        <p>Total Missions: <span id="totalMissions1" class="font-semibold"></span></p>
                        <p>Success Rate: <span id="successRate1" class="font-semibold"></span></p>
                        <p>Average Payload Mass: <span id="avgPayload1" class="font-semibold"></span></p>
                        <p>Average Mission Cost: <span id="avgCost1" class="font-semibold"></span></p>
                    </div>
                </div>
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4">Select Vehicle 2</h2>
                    <select id="compareVehicle2" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 mb-4">
                        <!-- Options will be populated by JS -->
                    </select>
                    <div class="space-y-2 text-gray-700">
                        <p>Total Missions: <span id="totalMissions2" class="font-semibold"></span></p>
                        <p>Success Rate: <span id="successRate2" class="font-semibold"></span></p>
                        <p>Average Payload Mass: <span id="avgPayload2" class="font-semibold"></span></p>
                        <p>Average Mission Cost: <span id="avgCost2" class="font-semibold"></span></p>
                    </div>
                </div>
            </div>

            <hr class="my-10 border-gray-300">

            <h2 class="text-3xl font-bold mb-4">Performance Comparison</h2>
            <div class="card mb-8">
                <canvas id="comparisonChart"></canvas>
            </div>
        </div>

        <!-- Mission Predictor Page -->
        <div id="predictor-page" class="section-container hidden">
            <h1 class="text-4xl font-bold mb-6">Mission Predictor</h1>
            <p class="text-lg text-gray-700 mb-8">Estimate the historical success rate for hypothetical mission parameters.</p>

            <div class="card mb-8">
                <h2 class="text-2xl font-bold mb-4">Configure Mission Parameters</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <label for="predictorVehicle" class="block text-sm font-medium text-gray-700 mb-2">Launch Vehicle Category</label>
                        <select id="predictorVehicle" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                    <div>
                        <label for="predictorPayloadMass" class="block text-sm font-medium text-gray-700 mb-2">Payload Mass (kg)</label>
                        <input type="range" id="predictorPayloadMass" min="100" max="4000" value="1500" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-xl">
                        <span class="text-sm text-gray-600" id="predictorPayloadMassValue">1500 kg</span>
                    </div>
                    <div>
                        <label for="predictorMissionCost" class="block text-sm font-medium text-gray-700 mb-2">Mission Cost (INR Cr)</label>
                        <input type="range" id="predictorMissionCost" min="50" max="500" value="250" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-xl">
                        <span class="text-sm text-gray-600" id="predictorMissionCostValue">₹250 Cr</span>
                    </div>
                    <div>
                        <label for="predictorOrbitType" class="block text-sm font-medium text-gray-700 mb-2">Target Orbit Type</label>
                        <select id="predictorOrbitType" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                    <div>
                        <label for="predictorPayloadType" class="block text-sm font-medium text-gray-700 mb-2">Payload Type</label>
                        <select id="predictorPayloadType" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                    <div>
                        <label for="predictorLaunchSite" class="block text-sm font-medium text-gray-700 mb-2">Launch Site</label>
                        <select id="predictorLaunchSite" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                            <!-- Options will be populated by JS -->
                        </select>
                    </div>
                </div>
            </div>
            
            <h2 class="text-3xl font-bold mb-4">Success Rate</h2>
            <div class="card p-6 flex flex-col items-center justify-center">
                <p class="text-gray-700 text-lg mb-2" id="predictorDescription"></p>
                <p class="text-5xl font-extrabold text-blue-600" id="predictedSuccessRate">--</p>
                <p class="text-gray-500 text-sm mt-2" id="predictorNote"></p>
            </div>
        </div>

        <!-- Mission Clusters Page -->
        <div id="clusters-page" class="section-container hidden">
            <h1 class="text-4xl font-bold mb-6">Mission Clusters</h1>
            <p class="text-lg text-gray-700 mb-8">Discover patterns in missions based on Payload Mass and Mission Cost.</p>

            <div class="card mb-8">
                <canvas id="clustersChart"></canvas>
            </div>

            <h2 class="text-3xl font-bold mb-4">Explore Missions in Each Cluster</h2>
            <div class="card mb-8">
                <label for="clusterSelect" class="block text-sm font-medium text-gray-700 mb-2">Select a Cluster:</label>
                <select id="clusterSelect" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                    <!-- Options will be populated by JS -->
                </select>
                <div id="clusterMissionsTable" class="mt-4 overflow-x-auto">
                    <!-- Table will be populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Random Data Generation Logic ---
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getRandomFloat(min, max) {
            return (Math.random() * (max - min) + min).toFixed(1);
        }

        function getRandomDate(startYear, endYear) {
            const year = getRandomInt(startYear, endYear);
            const month = getRandomInt(0, 11);
            const day = getRandomInt(1, 28); // Simplicity, avoid month-end issues
            return new Date(year, month, day);
        }

        const payloadTypes = ["Communication", "Earth Observation", "Navigation", "Scientific", "Experimental", "Defense", "Meteorology"];
        const orbitTypes = ["GTO", "SSO", "LEO", "Lunar Transfer Orbit", "Planetary Transfer Orbit", "Halo Orbit (L1)"];
        const launchSites = ["SDSC SHAR, FLP", "SDSC SHAR, SLP"];
        const launchOutcomes = ["Success", "Partial Failure", "Failure"]; // Reduced for more noticeable variability

        const generatedMissionsData = [];
        const numMissions = 120; // Generate 120 missions

        for (let i = 0; i < numMissions; i++) {
            const launchVehicleCategory = Math.random() < 0.55 ? 'PSLV' : 'GSLV'; // Slightly more PSLV
            let payloadMass, missionCost, launchOutcome;

            if (launchVehicleCategory === 'PSLV') {
                payloadMass = getRandomInt(100, 2000);
                missionCost = getRandomInt(50, 250);
                // Introduce some PSLV failures for variability
                if (Math.random() < 0.15) { // 15% failure rate for PSLV
                    launchOutcome = Math.random() < 0.5 ? "Partial Failure" : "Failure";
                } else {
                    launchOutcome = "Success";
                }
            } else { // GSLV
                payloadMass = getRandomInt(1500, 4000);
                missionCost = getRandomInt(200, 500);
                // Higher chance of failure for GSLV for variability
                if (Math.random() < 0.35) { // 35% failure rate for GSLV
                    launchOutcome = Math.random() < 0.5 ? "Partial Failure" : "Failure";
                } else {
                    launchOutcome = "Success";
                }
            }

            const launchDate = getRandomDate(2000, 2024);
            const orbitType = orbitTypes[getRandomInt(0, orbitTypes.length - 1)];
            const payloadType = payloadTypes[getRandomInt(0, payloadTypes.length - 1)];
            const launchSite = launchSites[getRandomInt(0, launchSites.length - 1)];

            generatedMissionsData.push({
                "Mission": `${launchVehicleCategory} Mission ${i + 1}`,
                "Launch Date": launchDate.toDateString(),
                "Launch Vehicle": launchVehicleCategory, // Simplified for direct mapping
                "Payload Mass (kg)": payloadMass,
                "Orbit Type": orbitType,
                "Payload Type": payloadType,
                "Launch Site": launchSite,
                "Launch Outcome": launchOutcome,
                "Mission Cost (INR Cr)": missionCost
            });
        }

        // Use the generated data
        const missionsData = generatedMissionsData;
        // End of Random Data Generation Logic

        // Process data for dashboard
        const processedData = missionsData.map(d => ({
            ...d,
            'Launch Date': new Date(d['Launch Date']),
            'Launch Year': new Date(d['Launch Date']).getFullYear(),
            'Launch Outcome Encoded': d['Launch Outcome'] === 'Success' ? 1 : 0,
            'Launch Outcome Display': d['Launch Outcome'] === 'Success' ? 'Success' : 'Failure/Partial Failure',
            // Ensure Launch Vehicle Category is directly from the generated 'Launch Vehicle'
            'Launch Vehicle Category': d['Launch Vehicle']
        })).filter(d => ['PSLV', 'GSLV'].includes(d['Launch Vehicle Category'])); // Filter out external launches (though none should be generated)


        // Get unique categories for dropdowns from the filtered data
        const uniqueVehicles = [...new Set(processedData.map(d => d['Launch Vehicle Category']))].sort();
        const uniquePayloadTypes = [...new Set(processedData.map(d => d['Payload Type']))].sort();
        const uniqueOrbits = [...new Set(processedData.map(d => d['Orbit Type']))].sort();
        const uniqueLaunchSites = [...new Set(processedData.map(d => d['Launch Site']))].sort();

        // Calculate and add a simple "Cluster" property for demonstration (not actual KMeans)
        const getCluster = (payloadMass, missionCost) => {
            if (payloadMass < 1000 && missionCost < 200) return 0;
            if (payloadMass >= 1000 && missionCost < 300) return 1;
            if (payloadMass < 2000 && missionCost >= 200) return 2;
            return 3;
        };
        processedData.forEach(d => {
            d['Cluster'] = getCluster(d['Payload Mass (kg)'], d['Mission Cost (INR Cr)']);
        });
        const uniqueClusters = [...new Set(processedData.map(d => d['Cluster']))].sort();


        let payloadMassChart, successRateChart, comparisonChart, clustersChart; // Chart instances

        // Function to show/hide pages
        function showPage(pageId) {
            document.querySelectorAll('.section-container').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId + '-page').classList.remove('hidden');

            // Update active navigation item styling
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-blue-700', 'text-white');
                item.classList.add('text-gray-100');
            });
            document.querySelector(`[onclick="showPage('${pageId}')"]`).classList.add('bg-blue-700', 'text-white');
            document.querySelector(`[onclick="showPage('${pageId}')"]`).classList.remove('text-gray-100');


            // Re-render charts when page is shown
            if (pageId === 'historical') {
                renderPayloadMassChart();
                renderSuccessRateChart();
            } else if (pageId === 'comparative') {
                populateComparativeSelects(); // Populates selects and calls updateComparativeStats
            } else if (pageId === 'predictor') {
                populatePredictorInputs(); // Populate inputs
                updatePrediction(); // Trigger initial prediction
            }
             else if (pageId === 'clusters') {
                renderClustersChart();
                populateClusterMissionsTable(document.getElementById('clusterSelect').value);
            }
        }

        // --- Historical Analysis Charts ---
        function renderPayloadMassChart(filteredData = processedData) {
            const ctx = document.getElementById('payloadMassChart').getContext('2d');
            if (payloadMassChart) payloadMassChart.destroy(); // Destroy previous chart instance

            const successData = filteredData.filter(d => d['Launch Outcome Display'] === 'Success');
            const failureData = filteredData.filter(d => d['Launch Outcome Display'] !== 'Success');

            payloadMassChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Success',
                        data: successData.map(d => ({ x: d['Launch Date'], y: d['Payload Mass (kg)'], r: d['Mission Cost (INR Cr)'] / 50 })),
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        pointRadius: 5,
                        pointHoverRadius: 8
                    }, {
                        label: 'Failure/Partial Failure',
                        data: failureData.map(d => ({ x: d['Launch Date'], y: d['Payload Mass (kg)'], r: d['Mission Cost (INR Cr)'] / 50 })),
                        backgroundColor: 'rgba(255, 99, 132, 0.6)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        pointRadius: 5,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            type: 'time',
                            time: { unit: 'year' },
                            title: { display: true, text: 'Launch Date' }
                        },
                        y: {
                            title: { display: true, text: 'Payload Mass (kg)' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.raw.y !== null) {
                                        label += `Payload: ${context.raw.y} kg`;
                                    }
                                    const mission = filteredData.find(d => d['Launch Date'].getTime() === context.raw.x.getTime() && d['Payload Mass (kg)'] === context.raw.y);
                                    if (mission) {
                                        label += ` | Cost: ₹${mission['Mission Cost (INR Cr)']} Cr`;
                                        label += ` | Vehicle: ${mission['Launch Vehicle Category']}`;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderSuccessRateChart(filteredData = processedData) {
            const ctx = document.getElementById('successRateChart').getContext('2d');
            if (successRateChart) successRateChart.destroy();

            const monthlyData = {};
            filteredData.forEach(d => {
                const month = d['Launch Date'].getMonth(); // 0-11
                if (!monthlyData[month]) {
                    monthlyData[month] = { total: 0, success: 0 };
                }
                monthlyData[month].total++;
                if (d['Launch Outcome Encoded'] === 1) {
                    monthlyData[month].success++;
                }
            });

            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const labels = [];
            const successRates = [];

            for (let i = 0; i < 12; i++) {
                labels.push(monthNames[i]);
                const data = monthlyData[i];
                if (data && data.total > 0) {
                    successRates.push((data.success / data.total) * 100);
                } else {
                    successRates.push(0);
                }
            }

            successRateChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Success Rate (%)',
                        data: successRates,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Success Rate (%)' },
                            max: 100
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw.toFixed(2)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- Comparative Analysis ---
        function renderComparativeAnalysis() {
            populateComparativeSelects(); // Populates the select elements
            // The onchange event listener within populateComparativeSelects will then trigger updateComparativeStats
        }

        function populateComparativeSelects() {
            const select1 = document.getElementById('compareVehicle1');
            const select2 = document.getElementById('compareVehicle2');
            select1.innerHTML = '';
            select2.innerHTML = '';

            // Filter uniqueVehicles to only include PSLV and GSLV for this section
            const comparativeVehicles = uniqueVehicles.filter(v => ['PSLV', 'GSLV'].includes(v));

            comparativeVehicles.forEach((vehicle) => {
                const option1 = document.createElement('option');
                option1.value = vehicle;
                option1.textContent = vehicle;
                select1.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = vehicle;
                option2.textContent = vehicle;
                select2.appendChild(option2);
            });

            // Set default selections after options are added
            if (comparativeVehicles.includes('PSLV')) select1.value = 'PSLV';
            if (comparativeVehicles.includes('GSLV')) select2.value = 'GSLV';
            
            select1.onchange = updateComparativeStats;
            select2.onchange = updateComparativeStats;

            // Manually trigger the first update after population to show initial charts
            updateComparativeStats();
        }

        function updateComparativeStats() {
            const vehicle1 = document.getElementById('compareVehicle1').value;
            const vehicle2 = document.getElementById('compareVehicle2').value;

            const df1 = processedData.filter(d => d['Launch Vehicle Category'] === vehicle1);
            const df2 = processedData.filter(d => d['Launch Vehicle Category'] === vehicle2);

            const calculateStats = (data) => {
                const totalMissions = data.length;
                const successMissions = data.filter(d => d['Launch Outcome Encoded'] === 1).length;
                const successRate = totalMissions > 0 ? (successMissions / totalMissions) * 100 : 0;
                const avgPayload = data.length > 0 ? data.reduce((sum, d) => sum + d['Payload Mass (kg)'], 0) / data.length : 0;
                const avgCost = data.length > 0 ? data.reduce((sum, d) => sum + d['Mission Cost (INR Cr)'], 0) / data.length : 0;
                return { totalMissions, successRate, avgPayload, avgCost };
            };

            const stats1 = calculateStats(df1);
            const stats2 = calculateStats(df2);

            document.getElementById('totalMissions1').textContent = stats1.totalMissions;
            document.getElementById('successRate1').textContent = `${stats1.successRate.toFixed(2)}%`;
            document.getElementById('avgPayload1').textContent = `${stats1.avgPayload.toFixed(2)} kg`;
            document.getElementById('avgCost1').textContent = `₹${stats1.avgCost.toFixed(2)} Cr`;

            document.getElementById('totalMissions2').textContent = stats2.totalMissions;
            document.getElementById('successRate2').textContent = `${stats2.successRate.toFixed(2)}%`;
            document.getElementById('avgPayload2').textContent = `${stats2.avgPayload.toFixed(2)} kg`;
            document.getElementById('avgCost2').textContent = `₹${stats2.avgCost.toFixed(2)} Cr`;

            updateComparisonChart(vehicle1, vehicle2, stats1, stats2);
        }

        function updateComparisonChart(v1, v2, s1, s2) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            if (comparisonChart) comparisonChart.destroy();

            const labels = ['Success Rate (%)', 'Avg. Payload Mass (kg)', 'Avg. Mission Cost (INR Cr)'];
            const dataV1 = [s1.successRate, s1.avgPayload, s1.avgCost];
            const dataV2 = [s2.successRate, s2.avgPayload, s2.avgCost];

            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: v1,
                        data: dataV1,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }, {
                        label: v2,
                        data: dataV2,
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Value' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toFixed(2);
                                        if (context.label === 'Success Rate (%)') label += '%';
                                        else if (context.label === 'Avg. Payload Mass (kg)') label += ' kg';
                                        else if (context.label === 'Avg. Mission Cost (INR Cr)') label += ' Cr';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- Mission Predictor Logic ---
        function populatePredictorInputs() {
            const predictorVehicle = document.getElementById('predictorVehicle');
            const predictorOrbitType = document.getElementById('predictorOrbitType');
            const predictorPayloadType = document.getElementById('predictorPayloadType');
            const predictorLaunchSite = document.getElementById('predictorLaunchSite');

            // Populate only PSLV and GSLV for the predictor vehicle
            const predictorVehicles = uniqueVehicles.filter(v => ['PSLV', 'GSLV'].includes(v));
            predictorVehicle.innerHTML = predictorVehicles.map(v => `<option value="${v}">${v}</option>`).join('');
            
            // Set default to GSLV for better demonstration of variability
            if (predictorVehicles.includes('GSLV')) {
                predictorVehicle.value = 'GSLV';
            } else if (predictorVehicles.includes('PSLV')) { // Fallback if GSLV not in data (unlikely for this data)
                predictorVehicle.value = 'PSLV';
            }


            predictorOrbitType.innerHTML = uniqueOrbits.map(o => `<option value="${o}">${o}</option>`).join('');
            predictorPayloadType.innerHTML = uniquePayloadTypes.map(p => `<option value="${p}">${p}</option>`).join('');
            predictorLaunchSite.innerHTML = uniqueLaunchSites.map(s => `<option value="${s}">${s}</option>`).join('');

            // Set up event listeners for inputs
            document.getElementById('predictorPayloadMass').oninput = updatePrediction;
            document.getElementById('predictorMissionCost').oninput = updatePrediction;
            predictorVehicle.onchange = updatePrediction;
            predictorOrbitType.onchange = updatePrediction;
            predictorPayloadType.onchange = updatePrediction;
            predictorLaunchSite.onchange = updatePrediction;

            // Initial display of slider values
            document.getElementById('predictorPayloadMassValue').textContent = `${document.getElementById('predictorPayloadMass').value} kg`;
            document.getElementById('predictorMissionCostValue').textContent = `₹${document.getElementById('predictorMissionCost').value} Cr`;
        }

        function updatePrediction() {
            const payloadMass = parseInt(document.getElementById('predictorPayloadMass').value);
            const missionCost = parseInt(document.getElementById('predictorMissionCost').value);
            const vehicle = document.getElementById('predictorVehicle').value;
            const orbitType = document.getElementById('predictorOrbitType').value;
            const payloadType = document.getElementById('predictorPayloadType').value;
            const launchSite = document.getElementById('predictorLaunchSite').value;

            document.getElementById('predictorPayloadMassValue').textContent = `${payloadMass} kg`;
            document.getElementById('predictorMissionCostValue').textContent = `₹${missionCost} Cr`;

            const payloadRange = 200; // +/- kg
            const costRange = 50;    // +/- Cr

            const calculateSuccessRate = (missions) => {
                if (missions.length === 0) return 0; // Should not happen with current logic, but for safety
                const successful = missions.filter(m => m['Launch Outcome Encoded'] === 1).length;
                return (successful / missions.length) * 100;
            };

            // 1. Try to find missions with similar parameters (narrowest filter)
            const narrowFilterMissions = processedData.filter(d => {
                return d['Launch Vehicle Category'] === vehicle &&
                       d['Orbit Type'] === orbitType &&
                       d['Payload Type'] === payloadType &&
                       d['Launch Site'] === launchSite &&
                       d['Payload Mass (kg)'] >= (payloadMass - payloadRange) &&
                       d['Payload Mass (kg)'] <= (payloadMass + payloadRange) &&
                       d['Mission Cost (INR Cr)'] >= (missionCost - costRange) &&
                       d['Mission Cost (INR Cr)'] <= (missionCost + costRange);
            });

            let successRate;
            let descriptionText = '';
            let noteText = '';
            
            if (narrowFilterMissions.length > 0) {
                successRate = calculateSuccessRate(narrowFilterMissions);
                descriptionText = `Based on ${narrowFilterMissions.length} historical mission(s) with similar parameters:`;
                noteText = 'This is an estimate based on past ISRO missions.';
            } else {
                // 2. Fallback: Find missions matching vehicle, orbit, payload, and site (broader filter)
                const broaderMissions = processedData.filter(d => {
                    return d['Launch Vehicle Category'] === vehicle &&
                           d['Orbit Type'] === orbitType &&
                           d['Payload Type'] === payloadType &&
                           d['Launch Site'] === launchSite;
                });

                if (broaderMissions.length > 0) {
                    successRate = calculateSuccessRate(broaderMissions);
                    descriptionText = `Based on ${broaderMissions.length} historical mission(s) with similar vehicle, orbit, payload, and site:`;
                    noteText = 'Adjust payload or cost for a more precise historical match.';
                } else {
                    // 3. Final Fallback: Overall success rate for the selected vehicle category
                    const vehicleSpecificMissions = processedData.filter(d => d['Launch Vehicle Category'] === vehicle);
                    if (vehicleSpecificMissions.length > 0) {
                        successRate = calculateSuccessRate(vehicleSpecificMissions);
                        descriptionText = `Based on the overall success rate of all ${vehicle} missions (${vehicleSpecificMissions.length}):`;
                        noteText = 'No missions found with similar detailed parameters. This is a general estimate.';
                    } else {
                        // Very unlikely given current data, but a final fallback
                        successRate = 50; // Neutral default if no data at all
                        descriptionText = 'Insufficient historical data for a meaningful estimate.';
                        noteText = 'Please try different parameters.';
                    }
                }
            }

            // Update display
            const predictedSuccessRateElem = document.getElementById('predictedSuccessRate');
            document.getElementById('predictorDescription').textContent = descriptionText;
            predictedSuccessRateElem.textContent = `${successRate.toFixed(2)}%`;
            document.getElementById('predictorNote').textContent = noteText;

            // Apply color based on success rate
            predictedSuccessRateElem.classList.remove('text-green-600', 'text-orange-600', 'text-red-600', 'text-gray-500');
            if (successRate >= 80) {
                predictedSuccessRateElem.classList.add('text-green-600');
            } else if (successRate >= 50) {
                predictedSuccessRateElem.classList.add('text-orange-600');
            } else {
                predictedSuccessRateElem.classList.add('text-red-600');
            }
            // Keep gray for truly insufficient data scenarios
            if (successRate === 50 && descriptionText === 'Insufficient historical data for a meaningful estimate.') { 
                 predictedSuccessRateElem.classList.add('text-gray-500');
            }
        }


        // --- Mission Clusters ---
        function renderClustersChart() {
            const ctx = document.getElementById('clustersChart').getContext('2d');
            if (clustersChart) clustersChart.destroy();

            const datasets = uniqueClusters.map(clusterId => {
                const clusterData = processedData.filter(d => d.Cluster === clusterId);
                const outcomeDisplaySuccess = clusterData.filter(d => d['Launch Outcome Display'] === 'Success');
                const outcomeDisplayFailure = clusterData.filter(d => d['Launch Outcome Display'] !== 'Success');

                // Using different shapes/styles for success vs. failure within each cluster
                return [
                    {
                        label: `Cluster ${clusterId} (Success)`,
                        data: outcomeDisplaySuccess.map(d => ({ x: d['Payload Mass (kg)'], y: d['Mission Cost (INR Cr)'] })),
                        backgroundColor: `hsla(${clusterId * 90}, 70%, 50%, 0.6)`, // Different hue per cluster
                        borderColor: `hsla(${clusterId * 90}, 70%, 50%, 1)`,
                        pointRadius: 6,
                        pointStyle: 'circle' // Circle for success
                    },
                    {
                        label: `Cluster ${clusterId} (Failure/Partial Failure)`,
                        data: outcomeDisplayFailure.map(d => ({ x: d['Payload Mass (kg)'], y: d['Mission Cost (INR Cr)'] })),
                        backgroundColor: `hsla(${clusterId * 90}, 70%, 50%, 0.6)`,
                        borderColor: `hsla(${clusterId * 90}, 70%, 50%, 1)`,
                        pointRadius: 6,
                        pointStyle: 'cross' // Cross for failure
                    }
                ];
            }).flat(); // Flatten the array of arrays

            clustersChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: { display: true, text: 'Payload Mass (kg)' }
                        },
                        y: {
                            title: { display: true, text: 'Mission Cost (INR Cr)' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    label += `Payload: ${context.raw.x} kg, Cost: ₹${context.raw.y} Cr`;
                                    const mission = processedData.find(d => d['Payload Mass (kg)'] === context.raw.x && d['Mission Cost (INR Cr)'] === context.raw.y);
                                    if (mission) {
                                        label += ` | Mission: ${mission['Mission']}`;
                                        label += ` | Outcome: ${mission['Launch Outcome']}`;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            populateClusterSelect();
        }

        function populateClusterSelect() {
            const select = document.getElementById('clusterSelect');
            select.innerHTML = ''; // Clear previous options
            uniqueClusters.forEach(clusterId => {
                const option = document.createElement('option');
                option.value = clusterId;
                option.textContent = `Cluster ${clusterId}`;
                select.appendChild(option);
            });
            select.onchange = (event) => populateClusterMissionsTable(event.target.value);
            if (uniqueClusters.length > 0) {
                populateClusterMissionsTable(uniqueClusters[0]); // Load first cluster by default
            }
        }

        function populateClusterMissionsTable(clusterId) {
            const tableDiv = document.getElementById('clusterMissionsTable');
            tableDiv.innerHTML = ''; // Clear previous table

            const missionsInCluster = processedData.filter(d => d.Cluster == clusterId);

            if (missionsInCluster.length === 0) {
                tableDiv.innerHTML = '<p class="text-gray-600">No missions in this cluster.</p>';
                return;
            }

            const table = document.createElement('table');
            table.classList.add('min-w-full', 'divide-y', 'divide-gray-200', 'rounded-lg', 'shadow-md', 'overflow-hidden');
            table.innerHTML = `
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mission</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Launch Vehicle</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Payload Mass (kg)</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mission Cost (INR Cr)</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Launch Outcome</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    ${missionsInCluster.map(m => `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${m['Mission']}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${m['Launch Vehicle Category']}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${m['Payload Mass (kg)']}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹${m['Mission Cost (INR Cr)']}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${m['Launch Outcome']}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            tableDiv.appendChild(table);
        }

        // Initialize dashboard when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('missionCount').textContent = processedData.length;

            // Populate filters for historical analysis
            const vehicleFilter = document.getElementById('vehicleFilter');
            const payloadFilter = document.getElementById('payloadFilter');

            // Ensure filters only show PSLV and GSLV
            const historicalFilterVehicles = uniqueVehicles.filter(v => ['PSLV', 'GSLV'].includes(v));

            historicalFilterVehicles.forEach(v => {
                const option = document.createElement('option');
                option.value = v;
                option.textContent = v;
                option.selected = true; // Select all by default
                vehicleFilter.appendChild(option);
            });

            uniquePayloadTypes.forEach(p => {
                const option = document.createElement('option');
                option.value = p;
                option.textContent = p;
                option.selected = true; // Select all by default
                payloadFilter.appendChild(option);
            });

            vehicleFilter.onchange = applyHistoricalFilters;
            payloadFilter.onchange = applyHistoricalFilters;

            function applyHistoricalFilters() {
                const selectedVehicles = Array.from(vehicleFilter.selectedOptions).map(option => option.value);
                const selectedPayloads = Array.from(payloadFilter.selectedOptions).map(option => option.value);

                const filtered = processedData.filter(d => 
                    selectedVehicles.includes(d['Launch Vehicle Category']) &&
                    selectedPayloads.includes(d['Payload Type'])
                );
                renderPayloadMassChart(filtered);
                renderSuccessRateChart(filtered);
            }

            // Show home page by default
            showPage('home');
        });
    </script>
</body>
</html>
